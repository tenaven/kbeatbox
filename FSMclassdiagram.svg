<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1379px" preserveAspectRatio="none" style="width:2362px;height:1379px;" version="1.1" viewBox="0 0 2362 1379" width="2362px" zoomAndPan="magnify"><defs><filter height="300%" id="f1jzdj6g90gkow" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter><filter height="1" id="b1jzdj6g90gkow0" width="1" x="0" y="0"><feFlood flood-color="#BFDDF0" result="flood"/><feComposite in="SourceGraphic" in2="flood" operator="over"/></filter><filter height="1" id="b1jzdj6g90gkow1" width="1" x="0" y="0"><feFlood flood-color="#F0F0F0" result="flood"/><feComposite in="SourceGraphic" in2="flood" operator="over"/></filter><filter height="1" id="b1jzdj6g90gkow2" width="1" x="0" y="0"><feFlood flood-color="#FFE6C7" result="flood"/><feComposite in="SourceGraphic" in2="flood" operator="over"/></filter></defs><g><text fill="#888888" font-family="sans-serif" font-size="30" lengthAdjust="spacingAndGlyphs" textLength="364" x="1002.5" y="27.8467">KBeatBox class diagram</text><!--class KafkaArmoringHeartBeatFiniteStateMachine--><rect fill="#BFDDF0" filter="url(#f1jzdj6g90gkow)" height="48" id="KafkaArmoringHeartBeatFiniteStateMachine" style="stroke: #001624; stroke-width: 1.5;" width="306" x="1198.5" y="1141.9219"/><ellipse cx="1213.5" cy="1157.9219" fill="#ADD1B2" rx="11" ry="11" style="stroke: #001624; stroke-width: 1.0;"/><path d="M1216.4688,1163.5625 Q1215.8906,1163.8594 1215.25,1164.0078 Q1214.6094,1164.1563 1213.9063,1164.1563 Q1211.4063,1164.1563 1210.0859,1162.5078 Q1208.7656,1160.8594 1208.7656,1157.7344 Q1208.7656,1154.6094 1210.0859,1152.9531 Q1211.4063,1151.2969 1213.9063,1151.2969 Q1214.6094,1151.2969 1215.2578,1151.4531 Q1215.9063,1151.6094 1216.4688,1151.9063 L1216.4688,1154.625 Q1215.8438,1154.0469 1215.25,1153.7734 Q1214.6563,1153.5 1214.0313,1153.5 Q1212.6875,1153.5 1212,1154.5703 Q1211.3125,1155.6406 1211.3125,1157.7344 Q1211.3125,1159.8281 1212,1160.8984 Q1212.6875,1161.9688 1214.0313,1161.9688 Q1214.6563,1161.9688 1215.25,1161.6953 Q1215.8438,1161.4219 1216.4688,1160.8438 L1216.4688,1163.5625 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="274" x="1227.5" y="1162.0762">KafkaArmoringHeartBeatFiniteStateMachine</text><line style="stroke: #001624; stroke-width: 1.5;" x1="1199.5" x2="1503.5" y1="1173.9219" y2="1173.9219"/><line style="stroke: #001624; stroke-width: 1.5;" x1="1199.5" x2="1503.5" y1="1181.9219" y2="1181.9219"/><!--class ArmoringHeartBeatFiniteStateMachine--><rect fill="#BFDDF0" filter="url(#f1jzdj6g90gkow)" height="48" id="ArmoringHeartBeatFiniteStateMachine" style="stroke: #001624; stroke-width: 1.5;" width="272" x="1215.5" y="1008.4219"/><ellipse cx="1230.5" cy="1024.4219" fill="#A9DCDF" rx="11" ry="11" style="stroke: #001624; stroke-width: 1.0;"/><path d="M1230.6094,1019.7656 L1229.4531,1024.8438 L1231.7813,1024.8438 L1230.6094,1019.7656 Z M1229.125,1017.5313 L1232.1094,1017.5313 L1235.4688,1029.9219 L1233.0156,1029.9219 L1232.25,1026.8594 L1228.9688,1026.8594 L1228.2188,1029.9219 L1225.7813,1029.9219 L1229.125,1017.5313 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="240" x="1244.5" y="1028.5762">ArmoringHeartBeatFiniteStateMachine</text><line style="stroke: #001624; stroke-width: 1.5;" x1="1216.5" x2="1486.5" y1="1040.4219" y2="1040.4219"/><line style="stroke: #001624; stroke-width: 1.5;" x1="1216.5" x2="1486.5" y1="1048.4219" y2="1048.4219"/><path d="M1539.5,1153.4219 L1539.5,1161.9219 L1504.56,1165.9219 L1539.5,1169.9219 L1539.5,1178.5547 A0,0 0 0 0 1539.5,1178.5547 L1795.5,1178.5547 A0,0 0 0 0 1795.5,1178.5547 L1795.5,1163.4219 L1785.5,1153.4219 L1539.5,1153.4219 A0,0 0 0 0 1539.5,1153.4219 " fill="#FFE6C7" filter="url(#f1jzdj6g90gkow)" style="stroke: #001624; stroke-width: 1.0;"/><path d="M1785.5,1153.4219 L1785.5,1163.4219 L1795.5,1163.4219 L1785.5,1153.4219 " fill="#FFE6C7" style="stroke: #001624; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="235" x="1545.5" y="1170.4888">responsible for integration with Kafka</text><!--class HeartBeatKeepingFiniteStateMachine--><rect fill="#BFDDF0" filter="url(#f1jzdj6g90gkow)" height="48" id="HeartBeatKeepingFiniteStateMachine" style="stroke: #001624; stroke-width: 1.5;" width="267" x="1218" y="846.4219"/><ellipse cx="1233" cy="862.4219" fill="#A9DCDF" rx="11" ry="11" style="stroke: #001624; stroke-width: 1.0;"/><path d="M1233.1094,857.7656 L1231.9531,862.8438 L1234.2813,862.8438 L1233.1094,857.7656 Z M1231.625,855.5313 L1234.6094,855.5313 L1237.9688,867.9219 L1235.5156,867.9219 L1234.75,864.8594 L1231.4688,864.8594 L1230.7188,867.9219 L1228.2813,867.9219 L1231.625,855.5313 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="235" x="1247" y="866.5762">HeartBeatKeepingFiniteStateMachine</text><line style="stroke: #001624; stroke-width: 1.5;" x1="1219" x2="1484" y1="878.4219" y2="878.4219"/><line style="stroke: #001624; stroke-width: 1.5;" x1="1219" x2="1484" y1="886.4219" y2="886.4219"/><path d="M1522.5,1019.9219 L1522.5,1028.4219 L1487.75,1032.4219 L1522.5,1036.4219 L1522.5,1045.0547 A0,0 0 0 0 1522.5,1045.0547 L2350.5,1045.0547 A0,0 0 0 0 2350.5,1045.0547 L2350.5,1029.9219 L2340.5,1019.9219 L1522.5,1019.9219 A0,0 0 0 0 1522.5,1019.9219 " fill="#FFE6C7" filter="url(#f1jzdj6g90gkow)" style="stroke: #001624; stroke-width: 1.0;"/><path d="M2340.5,1019.9219 L2340.5,1029.9219 L2350.5,1029.9219 L2340.5,1019.9219 " fill="#FFE6C7" style="stroke: #001624; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="807" x="1528.5" y="1036.9888">Responsible for protecting the underlying MealyFiniteStateMachine from wrong inputs. Rejects the InputEvents it deems wrong.</text><!--class IndexOptimizedLiftedTaskStateFiniteStateMachine--><rect fill="#BFDDF0" filter="url(#f1jzdj6g90gkow)" height="48" id="IndexOptimizedLiftedTaskStateFiniteStateMachine" style="stroke: #001624; stroke-width: 1.5;" width="344" x="1302.5" y="687.9219"/><ellipse cx="1317.5" cy="703.9219" fill="#A9DCDF" rx="11" ry="11" style="stroke: #001624; stroke-width: 1.0;"/><path d="M1317.6094,699.2656 L1316.4531,704.3438 L1318.7813,704.3438 L1317.6094,699.2656 Z M1316.125,697.0313 L1319.1094,697.0313 L1322.4688,709.4219 L1320.0156,709.4219 L1319.25,706.3594 L1315.9688,706.3594 L1315.2188,709.4219 L1312.7813,709.4219 L1316.125,697.0313 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="312" x="1331.5" y="708.0762">IndexOptimizedLiftedTaskStateFiniteStateMachine</text><line style="stroke: #001624; stroke-width: 1.5;" x1="1303.5" x2="1645.5" y1="719.9219" y2="719.9219"/><line style="stroke: #001624; stroke-width: 1.5;" x1="1303.5" x2="1645.5" y1="727.9219" y2="727.9219"/><path d="M1520.5,857.9219 L1520.5,866.4219 L1485.02,870.4219 L1520.5,874.4219 L1520.5,883.0547 A0,0 0 0 0 1520.5,883.0547 L2026.5,883.0547 A0,0 0 0 0 2026.5,883.0547 L2026.5,867.9219 L2016.5,857.9219 L1520.5,857.9219 A0,0 0 0 0 1520.5,857.9219 " fill="#FFE6C7" filter="url(#f1jzdj6g90gkow)" style="stroke: #001624; stroke-width: 1.0;"/><path d="M2016.5,857.9219 L2016.5,867.9219 L2026.5,867.9219 L2016.5,857.9219 " fill="#FFE6C7" style="stroke: #001624; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="485" x="1526.5" y="874.9888">MealyFiniteStateMachine responsible of keeping the most recent heartBeat.</text><!--class LiftedTaskStateFiniteStateMachine--><rect fill="#BFDDF0" filter="url(#f1jzdj6g90gkow)" height="48" id="LiftedTaskStateFiniteStateMachine" style="stroke: #001624; stroke-width: 1.5;" width="249" x="1182" y="538.9219"/><ellipse cx="1197" cy="554.9219" fill="#A9DCDF" rx="11" ry="11" style="stroke: #001624; stroke-width: 1.0;"/><path d="M1197.1094,550.2656 L1195.9531,555.3438 L1198.2813,555.3438 L1197.1094,550.2656 Z M1195.625,548.0313 L1198.6094,548.0313 L1201.9688,560.4219 L1199.5156,560.4219 L1198.75,557.3594 L1195.4688,557.3594 L1194.7188,560.4219 L1192.2813,560.4219 L1195.625,548.0313 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="217" x="1211" y="559.0762">LiftedTaskStateFiniteStateMachine</text><line style="stroke: #001624; stroke-width: 1.5;" x1="1183" x2="1430" y1="570.9219" y2="570.9219"/><line style="stroke: #001624; stroke-width: 1.5;" x1="1183" x2="1430" y1="578.9219" y2="578.9219"/><path d="M1681.5,699.4219 L1681.5,707.9219 L1646.75,711.9219 L1681.5,715.9219 L1681.5,724.5547 A0,0 0 0 0 1681.5,724.5547 L2303.5,724.5547 A0,0 0 0 0 2303.5,724.5547 L2303.5,709.4219 L2293.5,699.4219 L1681.5,699.4219 A0,0 0 0 0 1681.5,699.4219 " fill="#FFE6C7" filter="url(#f1jzdj6g90gkow)" style="stroke: #001624; stroke-width: 1.0;"/><path d="M2293.5,699.4219 L2293.5,709.4219 L2303.5,709.4219 L2293.5,699.4219 " fill="#FFE6C7" style="stroke: #001624; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="601" x="1687.5" y="716.4888">MealyFiniteStateMachine responsible of keeping two indexes updated to improve performance</text><!--class PriorityQueueTaskStateFiniteStateMachine--><rect fill="#BFDDF0" filter="url(#f1jzdj6g90gkow)" height="48" id="PriorityQueueTaskStateFiniteStateMachine" style="stroke: #001624; stroke-width: 1.5;" width="297" x="1088" y="386.4219"/><ellipse cx="1103" cy="402.4219" fill="#A9DCDF" rx="11" ry="11" style="stroke: #001624; stroke-width: 1.0;"/><path d="M1103.1094,397.7656 L1101.9531,402.8438 L1104.2813,402.8438 L1103.1094,397.7656 Z M1101.625,395.5313 L1104.6094,395.5313 L1107.9688,407.9219 L1105.5156,407.9219 L1104.75,404.8594 L1101.4688,404.8594 L1100.7188,407.9219 L1098.2813,407.9219 L1101.625,395.5313 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="265" x="1117" y="406.5762">PriorityQueueTaskStateFiniteStateMachine</text><line style="stroke: #001624; stroke-width: 1.5;" x1="1089" x2="1384" y1="418.4219" y2="418.4219"/><line style="stroke: #001624; stroke-width: 1.5;" x1="1089" x2="1384" y1="426.4219" y2="426.4219"/><path d="M1466.5,542.9219 L1466.5,558.9219 L1431.34,562.9219 L1466.5,566.9219 L1466.5,583.1875 A0,0 0 0 0 1466.5,583.1875 L2086.5,583.1875 A0,0 0 0 0 2086.5,583.1875 L2086.5,552.9219 L2076.5,542.9219 L1466.5,542.9219 A0,0 0 0 0 1466.5,542.9219 " fill="#FFE6C7" filter="url(#f1jzdj6g90gkow)" style="stroke: #001624; stroke-width: 1.0;"/><path d="M2076.5,542.9219 L2076.5,552.9219 L2086.5,552.9219 L2076.5,542.9219 " fill="#FFE6C7" style="stroke: #001624; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="599" x="1472.5" y="559.9888">MealyFiniteStateMachine responsible for the use of multiple ScheduledTask at the same time.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="221" x="1476.5" y="575.1216">(by using an taskname-index Map)</text><!--class SingleTaskStateFiniteStateMachine--><rect fill="#BFDDF0" filter="url(#f1jzdj6g90gkow)" height="48" id="SingleTaskStateFiniteStateMachine" style="stroke: #001624; stroke-width: 1.5;" width="252" x="1087.5" y="227.4219"/><ellipse cx="1102.5" cy="243.4219" fill="#A9DCDF" rx="11" ry="11" style="stroke: #001624; stroke-width: 1.0;"/><path d="M1102.6094,238.7656 L1101.4531,243.8438 L1103.7813,243.8438 L1102.6094,238.7656 Z M1101.125,236.5313 L1104.1094,236.5313 L1107.4688,248.9219 L1105.0156,248.9219 L1104.25,245.8594 L1100.9688,245.8594 L1100.2188,248.9219 L1097.7813,248.9219 L1101.125,236.5313 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="220" x="1116.5" y="247.5762">SingleTaskStateFiniteStateMachine</text><line style="stroke: #001624; stroke-width: 1.5;" x1="1088.5" x2="1338.5" y1="259.4219" y2="259.4219"/><line style="stroke: #001624; stroke-width: 1.5;" x1="1088.5" x2="1338.5" y1="267.4219" y2="267.4219"/><path d="M1420.5,397.9219 L1420.5,406.4219 L1385.3,410.4219 L1420.5,414.4219 L1420.5,423.0547 A0,0 0 0 0 1420.5,423.0547 L1908.5,423.0547 A0,0 0 0 0 1908.5,423.0547 L1908.5,407.9219 L1898.5,397.9219 L1420.5,397.9219 A0,0 0 0 0 1420.5,397.9219 " fill="#FFE6C7" filter="url(#f1jzdj6g90gkow)" style="stroke: #001624; stroke-width: 1.0;"/><path d="M1898.5,397.9219 L1898.5,407.9219 L1908.5,407.9219 L1898.5,397.9219 " fill="#FFE6C7" style="stroke: #001624; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="467" x="1426.5" y="414.9888">Responsible for allowing different priorities of task overriding one another.</text><!--class MealyFiniteStateMachine--><a target="_top" xlink:actuate="onRequest" xlink:href="src/main/scala/net/deeppay/kmicrostreams/kbeatbox/finitestatemachine/MealyFiniteStateMachine.scala" xlink:show="new" xlink:title="src/main/scala/net/deeppay/kmicrostreams/kbeatbox/finitestatemachine/MealyFiniteStateMachine.scala" xlink:type="simple"><rect fill="#BFDDF0" filter="url(#f1jzdj6g90gkow)" height="99.2188" id="MealyFiniteStateMachine" style="stroke: #001624; stroke-width: 1.5;" width="427" x="1000" y="42.9219"/><ellipse cx="1131.25" cy="58.9219" fill="#A9DCDF" rx="11" ry="11" style="stroke: #001624; stroke-width: 1.0;"/><path d="M1131.3594,54.2656 L1130.2031,59.3438 L1132.5313,59.3438 L1131.3594,54.2656 Z M1129.875,52.0313 L1132.8594,52.0313 L1136.2188,64.4219 L1133.7656,64.4219 L1133,61.3594 L1129.7188,61.3594 L1128.9688,64.4219 L1126.5313,64.4219 L1129.875,52.0313 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="156" x="1151.75" y="63.0762">MealyFiniteStateMachine</text><line style="stroke: #001624; stroke-width: 1.5;" x1="1001" x2="1426" y1="74.9219" y2="74.9219"/><line style="stroke: #001624; stroke-width: 1.5;" x1="1001" x2="1426" y1="82.9219" y2="82.9219"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="96" x="1006" y="97.1323">def zero() : State</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="362" x="1006" y="109.937">def transition(sourceState: State, event: Event) : (State, List[T])</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="350" x="1006" y="122.7417">def acceptFact(sourceState: State, fact: Fact) : (State, List[T])</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="415" x="1006" y="135.5464">def updateTask(sourceState: State, task: ScheduleTask) : (State, List[T])</text></a><path d="M1375,238.9219 L1375,247.4219 L1339.74,251.4219 L1375,255.4219 L1375,264.0547 A0,0 0 0 0 1375,264.0547 L2006,264.0547 A0,0 0 0 0 2006,264.0547 L2006,248.9219 L1996,238.9219 L1375,238.9219 A0,0 0 0 0 1375,238.9219 " fill="#FFE6C7" filter="url(#f1jzdj6g90gkow)" style="stroke: #001624; stroke-width: 1.0;"/><path d="M1996,238.9219 L1996,248.9219 L2006,248.9219 L1996,238.9219 " fill="#FFE6C7" style="stroke: #001624; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="610" x="1381" y="255.9888">This MealyFiniteStateMachine is specifically responsible for use the at most one ScheduledTask.</text><path d="M1462,72.4219 L1462,88.4219 L1427.48,92.4219 L1462,96.4219 L1462,112.6875 A0,0 0 0 0 1462,112.6875 L1941,112.6875 A0,0 0 0 0 1941,112.6875 L1941,82.4219 L1931,72.4219 L1462,72.4219 A0,0 0 0 0 1462,72.4219 " fill="#FFE6C7" filter="url(#f1jzdj6g90gkow)" style="stroke: #001624; stroke-width: 1.0;"/><path d="M1931,72.4219 L1931,82.4219 L1941,82.4219 L1931,72.4219 " fill="#FFE6C7" style="stroke: #001624; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="172" x="1468" y="89.4888">This is an abstraction of a (</text><a target="_top" xlink:actuate="onRequest" xlink:href="https://en.wikipedia.org/wiki/Mealy_machine" xlink:show="new" xlink:title="https://en.wikipedia.org/wiki/Mealy_machine" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="37" x="1640" y="89.4888">Mealy</text><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1640" x2="1677" y1="91.4888" y2="91.4888"/></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="1677" y="89.4888">) FiniteStateMachine.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="454" x="1472" y="104.6216">it uses a State, an InputEvent alphabet as Input and a Trace as Output.</text><!--class LiftedTaskStateInterface--><rect fill="#BFDDF0" filter="url(#f1jzdj6g90gkow)" height="86.4141" id="LiftedTaskStateInterface" style="stroke: #001624; stroke-width: 1.5;" width="557" x="590" y="519.9219"/><ellipse cx="787.25" cy="535.9219" fill="#B4A7E5" rx="11" ry="11" style="stroke: #001624; stroke-width: 1.0;"/><path d="M783.1719,531.6875 L783.1719,529.5313 L790.5625,529.5313 L790.5625,531.6875 L788.0938,531.6875 L788.0938,539.7656 L790.5625,539.7656 L790.5625,541.9219 L783.1719,541.9219 L783.1719,539.7656 L785.6406,539.7656 L785.6406,531.6875 L783.1719,531.6875 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="154" x="807.75" y="540.0762">LiftedTaskStateInterface</text><line style="stroke: #001624; stroke-width: 1.5;" x1="591" x2="1146" y1="551.9219" y2="551.9219"/><line style="stroke: #001624; stroke-width: 1.5;" x1="591" x2="1146" y1="559.9219" y2="559.9219"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="370" x="596" y="574.1323">def getTaskForId(taskId: String) : Option[PriorityQueueTaskState]</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="545" x="596" y="586.937">def updateAListOfTasks(updatedTasks: List[(String, Option[PriorityQueueTaskState])]): this.type</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="341" x="596" y="599.7417">def getTaskNamesForFactFromIndex(fact : Fact): List[String]</text><!--class IndexOptimizedLiftedTaskStateInterface--><rect fill="#BFDDF0" filter="url(#f1jzdj6g90gkow)" height="60.8047" id="IndexOptimizedLiftedTaskStateInterface" style="stroke: #001624; stroke-width: 1.5;" width="797" x="470" y="681.4219"/><ellipse cx="739.75" cy="697.4219" fill="#B4A7E5" rx="11" ry="11" style="stroke: #001624; stroke-width: 1.0;"/><path d="M735.6719,693.1875 L735.6719,691.0313 L743.0625,691.0313 L743.0625,693.1875 L740.5938,693.1875 L740.5938,701.2656 L743.0625,701.2656 L743.0625,703.4219 L735.6719,703.4219 L735.6719,701.2656 L738.1406,701.2656 L738.1406,693.1875 L735.6719,693.1875 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="249" x="760.25" y="701.5762">IndexOptimizedLiftedTaskStateInterface</text><line style="stroke: #001624; stroke-width: 1.5;" x1="471" x2="1266" y1="713.4219" y2="713.4219"/><line style="stroke: #001624; stroke-width: 1.5;" x1="471" x2="1266" y1="721.4219" y2="721.4219"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="785" x="476" y="735.6323">def applyFunctionOnTaskConditionsInIndex(taskName: String, condition: Condition, function: (Set[String], String) =&gt; Set[String]): this.type</text><!--class HeartBeatKeepingStateInterface--><rect fill="#BFDDF0" filter="url(#f1jzdj6g90gkow)" height="73.6094" id="HeartBeatKeepingStateInterface" style="stroke: #001624; stroke-width: 1.5;" width="383" x="677" y="833.4219"/><ellipse cx="761.25" cy="849.4219" fill="#B4A7E5" rx="11" ry="11" style="stroke: #001624; stroke-width: 1.0;"/><path d="M757.1719,845.1875 L757.1719,843.0313 L764.5625,843.0313 L764.5625,845.1875 L762.0938,845.1875 L762.0938,853.2656 L764.5625,853.2656 L764.5625,855.4219 L757.1719,855.4219 L757.1719,853.2656 L759.6406,853.2656 L759.6406,845.1875 L757.1719,845.1875 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="206" x="781.75" y="853.5762">HeartBeatKeepingStateInterface</text><line style="stroke: #001624; stroke-width: 1.5;" x1="678" x2="1059" y1="865.4219" y2="865.4219"/><line style="stroke: #001624; stroke-width: 1.5;" x1="678" x2="1059" y1="873.4219" y2="873.4219"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="371" x="683" y="887.6323">def update(currentTime : Long) : HeartBeatKeepingStateInterface</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="291" x="683" y="900.437">def getLastReceivedHeartBeatTime() : Option[Long]</text><!--class PriorityQueueTaskState--><rect fill="#BFDDF0" filter="url(#f1jzdj6g90gkow)" height="99.2188" id="PriorityQueueTaskState" style="stroke: #001624; stroke-width: 1.5;" width="369" x="684" y="360.9219"/><ellipse cx="790.75" cy="376.9219" fill="#ADD1B2" rx="11" ry="11" style="stroke: #001624; stroke-width: 1.0;"/><path d="M793.7188,382.5625 Q793.1406,382.8594 792.5,383.0078 Q791.8594,383.1563 791.1563,383.1563 Q788.6563,383.1563 787.3359,381.5078 Q786.0156,379.8594 786.0156,376.7344 Q786.0156,373.6094 787.3359,371.9531 Q788.6563,370.2969 791.1563,370.2969 Q791.8594,370.2969 792.5078,370.4531 Q793.1563,370.6094 793.7188,370.9063 L793.7188,373.625 Q793.0938,373.0469 792.5,372.7734 Q791.9063,372.5 791.2813,372.5 Q789.9375,372.5 789.25,373.5703 Q788.5625,374.6406 788.5625,376.7344 Q788.5625,378.8281 789.25,379.8984 Q789.9375,380.9688 791.2813,380.9688 Q791.9063,380.9688 792.5,380.6953 Q793.0938,380.4219 793.7188,379.8438 L793.7188,382.5625 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="147" x="811.25" y="381.0762">PriorityQueueTaskState</text><line style="stroke: #001624; stroke-width: 1.5;" x1="685" x2="1052" y1="392.9219" y2="392.9219"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="107" x="690" y="407.1323">taskName : String,</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="357" x="690" y="419.937">priorityQueue : TreeMap[Int, Set[Condition]] = TreeMap.empty,</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="205" x="690" y="432.7417">matchedConditions : Set[Condition],</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="123" x="690" y="445.5464">isTriggered : Boolean</text><line style="stroke: #001624; stroke-width: 1.5;" x1="685" x2="1052" y1="452.1406" y2="452.1406"/><!--class SingleTaskState--><rect fill="#BFDDF0" filter="url(#f1jzdj6g90gkow)" height="99.2188" id="SingleTaskState" style="stroke: #001624; stroke-width: 1.5;" width="233" x="774" y="201.9219"/><ellipse cx="835.75" cy="217.9219" fill="#ADD1B2" rx="11" ry="11" style="stroke: #001624; stroke-width: 1.0;"/><path d="M838.7188,223.5625 Q838.1406,223.8594 837.5,224.0078 Q836.8594,224.1563 836.1563,224.1563 Q833.6563,224.1563 832.3359,222.5078 Q831.0156,220.8594 831.0156,217.7344 Q831.0156,214.6094 832.3359,212.9531 Q833.6563,211.2969 836.1563,211.2969 Q836.8594,211.2969 837.5078,211.4531 Q838.1563,211.6094 838.7188,211.9063 L838.7188,214.625 Q838.0938,214.0469 837.5,213.7734 Q836.9063,213.5 836.2813,213.5 Q834.9375,213.5 834.25,214.5703 Q833.5625,215.6406 833.5625,217.7344 Q833.5625,219.8281 834.25,220.8984 Q834.9375,221.9688 836.2813,221.9688 Q836.9063,221.9688 837.5,221.6953 Q838.0938,221.4219 838.7188,220.8438 L838.7188,223.5625 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="101" x="856.25" y="222.0762">SingleTaskState</text><line style="stroke: #001624; stroke-width: 1.5;" x1="775" x2="1006" y1="233.9219" y2="233.9219"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="103" x="780" y="248.1323">taskName : String</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="176" x="780" y="260.937">taskConditions : Set[Condition]</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="221" x="780" y="273.7417">val matchedConditions : Set[Condition]</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="123" x="780" y="286.5464">isTriggered : Boolean</text><line style="stroke: #001624; stroke-width: 1.5;" x1="775" x2="1006" y1="293.1406" y2="293.1406"/><!--class LiftedTaskState--><rect fill="#F0F0F0" filter="url(#f1jzdj6g90gkow)" height="66.7422" id="LiftedTaskState" style="stroke: #001624; stroke-width: 1.5;" width="292" x="262.5" y="529.4219"/><ellipse cx="355.75" cy="548.3906" fill="#ADD1B2" rx="11" ry="11" style="stroke: #001624; stroke-width: 1.0;"/><path d="M358.7188,554.0313 Q358.1406,554.3281 357.5,554.4766 Q356.8594,554.625 356.1563,554.625 Q353.6563,554.625 352.3359,552.9766 Q351.0156,551.3281 351.0156,548.2031 Q351.0156,545.0781 352.3359,543.4219 Q353.6563,541.7656 356.1563,541.7656 Q356.8594,541.7656 357.5078,541.9219 Q358.1563,542.0781 358.7188,542.375 L358.7188,545.0938 Q358.0938,544.5156 357.5,544.2422 Q356.9063,543.9688 356.2813,543.9688 Q354.9375,543.9688 354.25,545.0391 Q353.5625,546.1094 353.5625,548.2031 Q353.5625,550.2969 354.25,551.3672 Q354.9375,552.4375 356.2813,552.4375 Q356.9063,552.4375 357.5,552.1641 Q358.0938,551.8906 358.7188,551.3125 L358.7188,554.0313 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="38" x="405.75" y="545.5605">«test»</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="97" x="376.25" y="559.5293">LiftedTaskState</text><line style="stroke: #001624; stroke-width: 1.5;" x1="263.5" x2="553.5" y1="567.3594" y2="567.3594"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="280" x="268.5" y="581.5698">taskStates : Map[String, PriorityQueueTaskState]</text><line style="stroke: #001624; stroke-width: 1.5;" x1="263.5" x2="553.5" y1="588.1641" y2="588.1641"/><!--class IndexOptimizedLiftedTaskMockState--><rect fill="#F0F0F0" filter="url(#f1jzdj6g90gkow)" height="92.3516" id="IndexOptimizedLiftedTaskMockState" style="stroke: #001624; stroke-width: 1.5;" width="429" x="6" y="665.9219"/><ellipse cx="105.25" cy="684.8906" fill="#ADD1B2" rx="11" ry="11" style="stroke: #001624; stroke-width: 1.0;"/><path d="M108.2188,690.5313 Q107.6406,690.8281 107,690.9766 Q106.3594,691.125 105.6563,691.125 Q103.1563,691.125 101.8359,689.4766 Q100.5156,687.8281 100.5156,684.7031 Q100.5156,681.5781 101.8359,679.9219 Q103.1563,678.2656 105.6563,678.2656 Q106.3594,678.2656 107.0078,678.4219 Q107.6563,678.5781 108.2188,678.875 L108.2188,681.5938 Q107.5938,681.0156 107,680.7422 Q106.4063,680.4688 105.7813,680.4688 Q104.4375,680.4688 103.75,681.5391 Q103.0625,682.6094 103.0625,684.7031 Q103.0625,686.7969 103.75,687.8672 Q104.4375,688.9375 105.7813,688.9375 Q106.4063,688.9375 107,688.6641 Q107.5938,688.3906 108.2188,687.8125 L108.2188,690.5313 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="38" x="217.75" y="682.0605">«test»</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="222" x="125.75" y="696.0293">IndexOptimizedLiftedTaskMockState</text><line style="stroke: #001624; stroke-width: 1.5;" x1="7" x2="434" y1="703.8594" y2="703.8594"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="371" x="12" y="718.0698">val ackIndex :  Map[AckEventCondition, Set[String]] = Map.empty,</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="417" x="12" y="730.8745">val hbIndex: TreeMap[HeartBeatCondition, Set[String]] = TreeMap.empty,</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="258" x="12" y="743.6792">val taskStates : Map[String, SingleTaskState]</text><line style="stroke: #001624; stroke-width: 1.5;" x1="7" x2="434" y1="750.2734" y2="750.2734"/><!--class HeartBeatKeepingMockState--><rect fill="#F0F0F0" filter="url(#f1jzdj6g90gkow)" height="105.1563" id="HeartBeatKeepingMockState" style="stroke: #001624; stroke-width: 1.5;" width="429" x="110" y="817.9219"/><ellipse cx="230.25" cy="836.8906" fill="#ADD1B2" rx="11" ry="11" style="stroke: #001624; stroke-width: 1.0;"/><path d="M233.2188,842.5313 Q232.6406,842.8281 232,842.9766 Q231.3594,843.125 230.6563,843.125 Q228.1563,843.125 226.8359,841.4766 Q225.5156,839.8281 225.5156,836.7031 Q225.5156,833.5781 226.8359,831.9219 Q228.1563,830.2656 230.6563,830.2656 Q231.3594,830.2656 232.0078,830.4219 Q232.6563,830.5781 233.2188,830.875 L233.2188,833.5938 Q232.5938,833.0156 232,832.7422 Q231.4063,832.4688 230.7813,832.4688 Q229.4375,832.4688 228.75,833.5391 Q228.0625,834.6094 228.0625,836.7031 Q228.0625,838.7969 228.75,839.8672 Q229.4375,840.9375 230.7813,840.9375 Q231.4063,840.9375 232,840.6641 Q232.5938,840.3906 233.2188,839.8125 L233.2188,842.5313 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="38" x="321.75" y="834.0605">«test»</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="180" x="250.75" y="848.0293">HeartBeatKeepingMockState</text><line style="stroke: #001624; stroke-width: 1.5;" x1="111" x2="538" y1="855.8594" y2="855.8594"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="260" x="116" y="870.0698">val lastReceivedHeartBeatTime : Option[Long]</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="371" x="116" y="882.8745">val ackIndex :  Map[AckEventCondition, Set[String]] = Map.empty,</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="417" x="116" y="895.6792">val hbIndex: TreeMap[HeartBeatCondition, Set[String]] = TreeMap.empty,</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="258" x="116" y="908.4839">val taskStates : Map[String, SingleTaskState]</text><line style="stroke: #001624; stroke-width: 1.5;" x1="111" x2="538" y1="915.0781" y2="915.0781"/><!--class HeartBeatKeepingKafkaState--><rect fill="#BFDDF0" filter="url(#f1jzdj6g90gkow)" height="99.2188" id="HeartBeatKeepingKafkaState" style="stroke: #001624; stroke-width: 1.5;" width="331" x="703" y="982.9219"/><ellipse cx="773.25" cy="998.9219" fill="#ADD1B2" rx="11" ry="11" style="stroke: #001624; stroke-width: 1.0;"/><path d="M776.2188,1004.5625 Q775.6406,1004.8594 775,1005.0078 Q774.3594,1005.1563 773.6563,1005.1563 Q771.1563,1005.1563 769.8359,1003.5078 Q768.5156,1001.8594 768.5156,998.7344 Q768.5156,995.6094 769.8359,993.9531 Q771.1563,992.2969 773.6563,992.2969 Q774.3594,992.2969 775.0078,992.4531 Q775.6563,992.6094 776.2188,992.9063 L776.2188,995.625 Q775.5938,995.0469 775,994.7734 Q774.4063,994.5 773.7813,994.5 Q772.4375,994.5 771.75,995.5703 Q771.0625,996.6406 771.0625,998.7344 Q771.0625,1000.8281 771.75,1001.8984 Q772.4375,1002.9688 773.7813,1002.9688 Q774.4063,1002.9688 775,1002.6953 Q775.5938,1002.4219 776.2188,1001.8438 L776.2188,1004.5625 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="182" x="793.75" y="1003.0762">HeartBeatKeepingKafkaState</text><line style="stroke: #001624; stroke-width: 1.5;" x1="704" x2="1033" y1="1014.9219" y2="1014.9219"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="310" x="709" y="1029.1323">var heartBeatStateStore : KeyValueStore[String, Long]</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="276" x="709" y="1041.937">var ackIndex : KeyValueStore[String, Set[String]]</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="264" x="709" y="1054.7417">var hbIndex : KeyValueStore[Long, Set[String]]</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="319" x="709" y="1067.5464">var taskStates : KeyValueStore[String, SingleTaskState]</text><line style="stroke: #001624; stroke-width: 1.5;" x1="704" x2="1033" y1="1074.1406" y2="1074.1406"/><!--link ArmoringHeartBeatFiniteStateMachine to KafkaArmoringHeartBeatFiniteStateMachine--><path d="M1351.5,1076.9369 C1351.5,1098.476 1351.5,1123.6238 1351.5,1141.5047 " fill="none" id="ArmoringHeartBeatFiniteStateMachine-KafkaArmoringHeartBeatFiniteStateMachine" style="stroke: #001624; stroke-width: 1.0;"/><polygon fill="none" points="1344.5,1076.6289,1351.5,1056.6289,1358.5,1076.6289,1344.5,1076.6289" style="stroke: #001624; stroke-width: 1.0;"/><!--link HeartBeatKeepingFiniteStateMachine to ArmoringHeartBeatFiniteStateMachine--><path d="M1351.5,914.7559 C1351.5,944.9369 1351.5,984.0009 1351.5,1008.3879 " fill="none" id="HeartBeatKeepingFiniteStateMachine-ArmoringHeartBeatFiniteStateMachine" style="stroke: #001624; stroke-width: 1.0;"/><polygon fill="none" points="1344.5,914.6869,1351.5,894.6869,1358.5,914.6869,1344.5,914.6869" style="stroke: #001624; stroke-width: 1.0;"/><!--link IndexOptimizedLiftedTaskStateFiniteStateMachine to HeartBeatKeepingFiniteStateMachine--><path d="M1443.69,752.1169 C1420.4,781.7619 1389.19,821.4629 1369.72,846.2349 " fill="none" id="IndexOptimizedLiftedTaskStateFiniteStateMachine-HeartBeatKeepingFiniteStateMachine" style="stroke: #001624; stroke-width: 1.0;"/><polygon fill="none" points="1438.49,747.4129,1456.35,736.0139,1449.5,756.0639,1438.49,747.4129" style="stroke: #001624; stroke-width: 1.0;"/><!--link LiftedTaskStateFiniteStateMachine to IndexOptimizedLiftedTaskStateFiniteStateMachine--><path d="M1348.35,600.5439 C1379.57,627.8559 1421.26,664.3389 1448,687.7379 " fill="none" id="LiftedTaskStateFiniteStateMachine-IndexOptimizedLiftedTaskStateFiniteStateMachine" style="stroke: #001624; stroke-width: 1.0;"/><polygon fill="none" points="1343.56,605.6529,1333.12,587.2149,1352.78,595.1169,1343.56,605.6529" style="stroke: #001624; stroke-width: 1.0;"/><!--link PriorityQueueTaskStateFiniteStateMachine to LiftedTaskStateFiniteStateMachine--><path d="M1255.86,453.0359 C1268.66,480.5709 1284.99,515.6709 1295.59,538.4619 " fill="none" id="PriorityQueueTaskStateFiniteStateMachine-LiftedTaskStateFiniteStateMachine" style="stroke: #001624; stroke-width: 1.0;"/><polygon fill="none" points="1249.37,455.6939,1247.28,434.6079,1262.07,449.7899,1249.37,455.6939" style="stroke: #001624; stroke-width: 1.0;"/><!--link SingleTaskStateFiniteStateMachine to PriorityQueueTaskStateFiniteStateMachine--><path d="M1219.83,295.6089 C1224.13,324.9639 1229.65,362.6409 1233.13,386.4169 " fill="none" id="SingleTaskStateFiniteStateMachine-PriorityQueueTaskStateFiniteStateMachine" style="stroke: #001624; stroke-width: 1.0;"/><polygon fill="none" points="1212.87,296.3909,1216.89,275.5879,1226.72,294.3619,1212.87,296.3909" style="stroke: #001624; stroke-width: 1.0;"/><!--link MealyFiniteStateMachine to SingleTaskStateFiniteStateMachine--><path d="M1213.5,162.5219 C1213.5,185.6719 1213.5,209.9249 1213.5,227.0789 " fill="none" id="MealyFiniteStateMachine-SingleTaskStateFiniteStateMachine" style="stroke: #001624; stroke-width: 1.0;"/><polygon fill="none" points="1206.5,162.2419,1213.5,142.2419,1220.5,162.2419,1206.5,162.2419" style="stroke: #001624; stroke-width: 1.0;"/><!--link LiftedTaskState to IndexOptimizedLiftedTaskMockState--><path d="M350.699,609.1169 C327.652,627.1379 301.179,647.8379 278.148,665.8459 " fill="none" id="LiftedTaskState-IndexOptimizedLiftedTaskMockState" style="stroke: #001624; stroke-width: 1.0;"/><polygon fill="none" points="346.709,603.3509,366.777,596.5459,355.333,614.3799,346.709,603.3509" style="stroke: #001624; stroke-width: 1.0;"/><!--link IndexOptimizedLiftedTaskMockState to HeartBeatKeepingMockState--><path d="M261.717,774.9459 C271.118,789.0929 281.011,803.9799 290.093,817.6459 " fill="none" id="IndexOptimizedLiftedTaskMockState-HeartBeatKeepingMockState" style="stroke: #001624; stroke-width: 1.0;"/><polygon fill="none" points="255.821,778.7199,250.581,758.1879,267.481,770.9709,255.821,778.7199" style="stroke: #001624; stroke-width: 1.0;"/><!--link PriorityQueueTaskState to LiftedTaskState--><path d="M720.104,459.9729 C655.267,481.1859 580.489,505.6519 520.441,525.2979 " fill="none" id="PriorityQueueTaskState-LiftedTaskState" style="stroke: #001624; stroke-width: 1.0;"/><polygon fill="#FFFFFF" points="507.86,529.4139,514.8064,531.3497,519.265,525.6821,512.3186,523.7463,507.86,529.4139" style="stroke: #001624; stroke-width: 1.0;"/><!--link PriorityQueueTaskState to LiftedTaskStateInterface--><path d="M868.5,460.2849 C868.5,475.1549 868.5,491.5989 868.5,506.8489 " fill="none" id="PriorityQueueTaskState-LiftedTaskStateInterface" style="stroke: #001624; stroke-width: 1.0;"/><polygon fill="#FFFFFF" points="868.5,519.8739,872.5,513.8739,868.5,507.8739,864.5,513.8739,868.5,519.8739" style="stroke: #001624; stroke-width: 1.0;"/><!--link PriorityQueueTaskState to PriorityQueueTaskStateFiniteStateMachine--><path d="M1053.22,410.4219 C1064.79,410.4219 1076.37,410.4219 1087.94,410.4219 " fill="none" id="PriorityQueueTaskState-PriorityQueueTaskStateFiniteStateMachine" style="stroke: #001624; stroke-width: 1.0; stroke-dasharray: 7.0,7.0;"/><!--link SingleTaskState to PriorityQueueTaskState--><path d="M883.66,301.2369 C881.601,315.9269 879.315,332.2439 877.155,347.6569 " fill="none" id="SingleTaskState-PriorityQueueTaskState" style="stroke: #001624; stroke-width: 1.0;"/><polygon fill="#FFFFFF" points="875.298,360.9069,880.092,355.5201,876.9635,349.023,872.1695,354.4098,875.298,360.9069" style="stroke: #001624; stroke-width: 1.0;"/><!--link SingleTaskState to SingleTaskStateFiniteStateMachine--><path d="M1007.21,251.4219 C1033.94,251.4219 1060.66,251.4219 1087.39,251.4219 " fill="none" id="SingleTaskState-SingleTaskStateFiniteStateMachine" style="stroke: #001624; stroke-width: 1.0; stroke-dasharray: 7.0,7.0;"/><!--link LiftedTaskState to LiftedTaskStateInterface--><path d="M554.945,562.9219 C559.854,562.9219 564.763,562.9219 569.672,562.9219 " fill="none" id="LiftedTaskState-LiftedTaskStateInterface" style="stroke: #001624; stroke-width: 1.0;"/><polygon fill="none" points="569.853,555.9219,589.853,562.9219,569.853,569.9219,569.853,555.9219" style="stroke: #001624; stroke-width: 1.0;"/><!--link LiftedTaskStateInterface to LiftedTaskStateFiniteStateMachine--><path d="M1147.38,562.9219 C1158.88,562.9219 1170.38,562.9219 1181.88,562.9219 " fill="none" id="LiftedTaskStateInterface-LiftedTaskStateFiniteStateMachine" style="stroke: #001624; stroke-width: 1.0; stroke-dasharray: 7.0,7.0;"/><!--link LiftedTaskStateInterface to IndexOptimizedLiftedTaskStateInterface--><path d="M868.5,626.1649 C868.5,645.3169 868.5,665.5149 868.5,681.3869 " fill="none" id="LiftedTaskStateInterface-IndexOptimizedLiftedTaskStateInterface" style="stroke: #001624; stroke-width: 1.0;"/><polygon fill="none" points="861.5,626.0459,868.5,606.0459,875.5,626.0459,861.5,626.0459" style="stroke: #001624; stroke-width: 1.0;"/><!--link IndexOptimizedLiftedTaskMockState to IndexOptimizedLiftedTaskStateInterface--><path d="M435.023,711.9219 C439.905,711.9219 444.786,711.9219 449.668,711.9219 " fill="none" id="IndexOptimizedLiftedTaskMockState-IndexOptimizedLiftedTaskStateInterface" style="stroke: #001624; stroke-width: 1.0;"/><polygon fill="none" points="449.735,704.9219,469.735,711.9219,449.735,718.9219,449.735,704.9219" style="stroke: #001624; stroke-width: 1.0;"/><!--link IndexOptimizedLiftedTaskStateInterface to IndexOptimizedLiftedTaskStateFiniteStateMachine--><path d="M1267.08,711.9219 C1278.82,711.9219 1290.57,711.9219 1302.32,711.9219 " fill="none" id="IndexOptimizedLiftedTaskStateInterface-IndexOptimizedLiftedTaskStateFiniteStateMachine" style="stroke: #001624; stroke-width: 1.0; stroke-dasharray: 7.0,7.0;"/><!--link HeartBeatKeepingMockState to HeartBeatKeepingStateInterface--><path d="M539.125,870.4219 C578.292,870.4219 617.46,870.4219 656.627,870.4219 " fill="none" id="HeartBeatKeepingMockState-HeartBeatKeepingStateInterface" style="stroke: #001624; stroke-width: 1.0;"/><polygon fill="none" points="656.793,863.4219,676.793,870.4219,656.793,877.4219,656.793,863.4219" style="stroke: #001624; stroke-width: 1.0;"/><!--link IndexOptimizedLiftedTaskStateInterface to HeartBeatKeepingStateInterface--><path d="M868.5,762.8579 C868.5,785.7939 868.5,812.4799 868.5,833.4099 " fill="none" id="IndexOptimizedLiftedTaskStateInterface-HeartBeatKeepingStateInterface" style="stroke: #001624; stroke-width: 1.0;"/><polygon fill="none" points="861.5,762.7269,868.5,742.7269,875.5,762.7269,861.5,762.7269" style="stroke: #001624; stroke-width: 1.0;"/><!--link HeartBeatKeepingStateInterface to HeartBeatKeepingFiniteStateMachine--><path d="M1060,870.4219 C1112.67,870.4219 1165.33,870.4219 1217.99,870.4219 " fill="none" id="HeartBeatKeepingStateInterface-HeartBeatKeepingFiniteStateMachine" style="stroke: #001624; stroke-width: 1.0; stroke-dasharray: 7.0,7.0;"/><!--link HeartBeatKeepingStateInterface to HeartBeatKeepingKafkaState--><path d="M868.5,927.7709 C868.5,945.7379 868.5,965.4529 868.5,982.8209 " fill="none" id="HeartBeatKeepingStateInterface-HeartBeatKeepingKafkaState" style="stroke: #001624; stroke-width: 1.0;"/><polygon fill="none" points="861.5,927.7289,868.5,907.7279,875.5,927.7279,861.5,927.7289" style="stroke: #001624; stroke-width: 1.0;"/><rect fill="#DDDDDD" height="160.6719" rx="5" ry="5" style="stroke: #000000; stroke-width: 1.0;" width="846" x="761" y="1207.9219"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="0" x="772" y="1227.917"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="793" y="1227.917">Type</text><text fill="#000000" filter="url(#b1jzdj6g90gkow0)" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="21" x="767" y="1244.2139">   </text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="116" x="792" y="1244.2139">Production Code</text><text fill="#000000" filter="url(#b1jzdj6g90gkow1)" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="21" x="767" y="1260.5107">   </text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="149" x="792" y="1260.5107">Test code and Mocks</text><text fill="#000000" filter="url(#b1jzdj6g90gkow2)" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="21" x="767" y="1276.8076">   </text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="40" x="792" y="1276.8076">notes</text><line style="stroke: #000000; stroke-width: 1.0;" x1="767" x2="945" y1="1214.9219" y2="1214.9219"/><line style="stroke: #000000; stroke-width: 1.0;" x1="767" x2="945" y1="1231.2188" y2="1231.2188"/><line style="stroke: #000000; stroke-width: 1.0;" x1="767" x2="945" y1="1247.5156" y2="1247.5156"/><line style="stroke: #000000; stroke-width: 1.0;" x1="767" x2="945" y1="1263.8125" y2="1263.8125"/><line style="stroke: #000000; stroke-width: 1.0;" x1="767" x2="945" y1="1280.1094" y2="1280.1094"/><line style="stroke: #000000; stroke-width: 1.0;" x1="767" x2="767" y1="1214.9219" y2="1280.1094"/><line style="stroke: #000000; stroke-width: 1.0;" x1="788" x2="788" y1="1214.9219" y2="1280.1094"/><line style="stroke: #000000; stroke-width: 1.0;" x1="945" x2="945" y1="1214.9219" y2="1280.1094"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="0" x="771" y="1295.1045"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="347" x="767" y="1311.4014">FiniteStateMachines are roughly retrocomptatible :</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="0" x="771" y="1327.6982"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="834" x="767" y="1343.9951">Tests that are passing for the SingleTaskStateFiniteStateMachine are also passing on all FiniteStateMachine downstream.</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="0" x="771" y="1360.292"/><!--
@startuml

skinparam arrowColor 001624
skinparam defaultBorderColor 001624

skinparam class {
	backgroundColor BFDDF0
	borderColor 001624
}
skinparam state {
	backgroundColor BFDDF0
	borderColor 001624
}

skinparam class<<test>> {
	backgroundColor F0F0F0
	borderColor 001624
}

skinparam note {
	backgroundColor FFE6C7
	borderColor 001624
}

skinparam queue {
	backgroundColor F5C0E4
	borderColor 001624
}
skinparam node {
	backgroundColor 658B00
	fontColor white
	borderColor 001624
}
skinparam rectangle {
	backgroundColor orange
	borderColor 001624
}
skinparam database {
    fontColor white
    borderColor white
    backgroundColor 033A5E
}

skinparam frame {
	backgroundColor FFBC68
}
center header <size:30>KBeatBox class diagram

class KafkaArmoringHeartBeatFiniteStateMachine extends ArmoringHeartBeatFiniteStateMachine

note right of KafkaArmoringHeartBeatFiniteStateMachine : responsible for integration with Kafka

abstract class ArmoringHeartBeatFiniteStateMachine extends HeartBeatKeepingFiniteStateMachine

note right of ArmoringHeartBeatFiniteStateMachine : Responsible for protecting the underlying MealyFiniteStateMachine from wrong inputs. Rejects the InputEvents it deems wrong.

abstract class HeartBeatKeepingFiniteStateMachine extends IndexOptimizedLiftedTaskStateFiniteStateMachine {
}

note right of HeartBeatKeepingFiniteStateMachine : MealyFiniteStateMachine responsible of keeping the most recent heartBeat.

abstract class IndexOptimizedLiftedTaskStateFiniteStateMachine extends LiftedTaskStateFiniteStateMachine {
}

note right of IndexOptimizedLiftedTaskStateFiniteStateMachine : MealyFiniteStateMachine responsible of keeping two indexes updated to improve performance

abstract class LiftedTaskStateFiniteStateMachine extends PriorityQueueTaskStateFiniteStateMachine {
}

note right of LiftedTaskStateFiniteStateMachine : MealyFiniteStateMachine responsible for the use of multiple ScheduledTask at the same time.\n (by using an taskname-index Map)

abstract class PriorityQueueTaskStateFiniteStateMachine extends SingleTaskStateFiniteStateMachine {
}

note right of PriorityQueueTaskStateFiniteStateMachine : Responsible for allowing different priorities of task overriding one another.

abstract class SingleTaskStateFiniteStateMachine extends MealyFiniteStateMachine {
}

note right of SingleTaskStateFiniteStateMachine : This MealyFiniteStateMachine is specifically responsible for use the at most one ScheduledTask.

abstract class MealyFiniteStateMachine [[src/main/scala/net/deeppay/kmicrostreams/kbeatbox/finitestatemachine/MealyFiniteStateMachine.scala]] {
  def zero() : State
  def transition(sourceState: State, event: Event) : (State, List[T])
  def acceptFact(sourceState: State, fact: Fact) : (State, List[T])
  def updateTask(sourceState: State, task: ScheduleTask) : (State, List[T])

}

note right of MealyFiniteStateMachine : This is an abstraction of a ([[https://en.wikipedia.org/wiki/Mealy_machine Mealy]]) FiniteStateMachine.\n it uses a State, an InputEvent alphabet as Input and a Trace as Output.



interface LiftedTaskStateInterface {
  def getTaskForId(taskId: String) : Option[PriorityQueueTaskState]
  def updateAListOfTasks(updatedTasks: List[(String, Option[PriorityQueueTaskState])]): this.type
  def getTaskNamesForFactFromIndex(fact : Fact): List[String]
}

interface IndexOptimizedLiftedTaskStateInterface {
  def applyFunctionOnTaskConditionsInIndex(taskName: String, condition: Condition, function: (Set[String], String) => Set[String]): this.type
}

interface HeartBeatKeepingStateInterface {
  def update(currentTime : Long) : HeartBeatKeepingStateInterface
  def getLastReceivedHeartBeatTime() : Option[Long]
}

class PriorityQueueTaskState {
  taskName : String,
  priorityQueue : TreeMap[Int, Set[Condition]] = TreeMap.empty,
  matchedConditions : Set[Condition],
  isTriggered : Boolean
}

class SingleTaskState {
  taskName : String
  taskConditions : Set[Condition]
  val matchedConditions : Set[Condition]
  isTriggered : Boolean
}

class LiftedTaskState<<test>> {
  taskStates : Map[String, PriorityQueueTaskState]
}

class IndexOptimizedLiftedTaskMockState <<test>> extends LiftedTaskState {
  val ackIndex :  Map[AckEventCondition, Set[String]] = Map.empty,
  val hbIndex: TreeMap[HeartBeatCondition, Set[String]] = TreeMap.empty,
  val taskStates : Map[String, SingleTaskState]
}

class HeartBeatKeepingMockState <<test>> extends IndexOptimizedLiftedTaskMockState {
  val lastReceivedHeartBeatTime : Option[Long]
  val ackIndex :  Map[AckEventCondition, Set[String]] = Map.empty,
  val hbIndex: TreeMap[HeartBeatCondition, Set[String]] = TreeMap.empty,
  val taskStates : Map[String, SingleTaskState]
}

class HeartBeatKeepingKafkaState {
  var heartBeatStateStore : KeyValueStore[String, Long]
  var ackIndex : KeyValueStore[String, Set[String]]
  var hbIndex : KeyValueStore[Long, Set[String]]
  var taskStates : KeyValueStore[String, SingleTaskState]
}

LiftedTaskState o-up- PriorityQueueTaskState

LiftedTaskStateInterface o-up- PriorityQueueTaskState

PriorityQueueTaskState .right. PriorityQueueTaskStateFiniteStateMachine

PriorityQueueTaskState o-up- SingleTaskState

SingleTaskState .right. SingleTaskStateFiniteStateMachine


LiftedTaskState -right-|> LiftedTaskStateInterface

LiftedTaskStateInterface .right. LiftedTaskStateFiniteStateMachine

IndexOptimizedLiftedTaskStateInterface -up-|> LiftedTaskStateInterface

IndexOptimizedLiftedTaskMockState -right-|> IndexOptimizedLiftedTaskStateInterface

IndexOptimizedLiftedTaskStateInterface .right. IndexOptimizedLiftedTaskStateFiniteStateMachine

HeartBeatKeepingMockState -right-|> HeartBeatKeepingStateInterface

HeartBeatKeepingStateInterface -up-|> IndexOptimizedLiftedTaskStateInterface

HeartBeatKeepingStateInterface .right. HeartBeatKeepingFiniteStateMachine

HeartBeatKeepingKafkaState -up-|> HeartBeatKeepingStateInterface

legend
|= |= Type |
|<back:#BFDDF0><U+2002><U+2002><U+2002></back>| Production Code |
|<back:#F0F0F0><U+2002><U+2002><U+2002></back>| Test code and Mocks |
|<back:#FFE6C7><U+2002><U+2002><U+2002></back>| notes |

FiniteStateMachines are roughly retrocomptatible :

Tests that are passing for the SingleTaskStateFiniteStateMachine are also passing on all FiniteStateMachine downstream.

endlegend


@enduml

PlantUML version 1.2018.08(Sun Jun 24 14:31:00 CEST 2018)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_144-b01
Operating System: Linux
OS Version: 4.15.0-24-generic
Default Encoding: UTF-8
Language: fr
Country: FR
--></g></svg>